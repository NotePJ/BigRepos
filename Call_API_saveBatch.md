# üìã ‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô API Integration: Batch Entry Save (saveBatchBudgetData)

**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á:** 19 ‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° 2025  
**‡∏ú‡∏π‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:** Ten (AI Developer)  
**‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥:** [‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å SA]  
**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** üìù **DRAFT - ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥**

---

## üìë ‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç

1. [‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£](#1-‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£)
2. [‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•](#2-‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
3. [‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö API Endpoint](#3-‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö-api-endpoint)
4. [Data Flow Architecture](#4-data-flow-architecture)
5. [Transaction Management](#5-transaction-management)
6. [Error Handling Strategy](#6-error-handling-strategy)
7. [Implementation Plan](#7-implementation-plan)
8. [Testing Strategy](#8-testing-strategy)
9. [Performance Considerations](#9-performance-considerations)
10. [Security & Validation](#10-security--validation)

---

## 1. ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£

### üéØ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå

‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà `setTimeout` simulation ‡πÉ‡∏ô `budget.plan.events.js` (line 5011-5015) ‡∏î‡πâ‡∏ß‡∏¢ API call ‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Batch Entry ‡πÅ‡∏ö‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏ñ‡∏ß‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô

### üìä ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

- **Frontend:** JavaScript (`saveBatchBudgetData()` function)
- **Backend:** 
  - Controller: `BudgetController.cs` - ‡πÄ‡∏û‡∏¥‡πà‡∏° endpoint `B0SaveBatchEntry`
  - Service: `BudgetService.cs` - ‡πÄ‡∏û‡∏¥‡πà‡∏° method `CreateBatchBudgetsAsync()`
  - DTO: ‡∏™‡∏£‡πâ‡∏≤‡∏á `BatchBudgetRequest.cs` ‡πÅ‡∏•‡∏∞ `BatchBudgetResponse.cs`

### üè¢ Company-Specific Tables

| Company | ID | Table | Model File |
|---------|----|----|-----------|
| **BJC** | 1 | `HRB_BUDGET_BJC` | `HRB_BUDGET_BJC.cs` |
| **BIGC** | 2 | `HRB_BUDGET_BIGC` | `HRB_BUDGET_BIGC.cs` |

**Key Insight:** ‡πÅ‡∏ï‡πà‡∏•‡∏∞ batch row **‡∏ï‡πâ‡∏≠‡∏á** save ‡πÑ‡∏õ‡∏¢‡∏±‡∏á table ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° `CompanyId` ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏

---

## 2. ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

### üì¶ Current Data Structure (JavaScript)

‡∏à‡∏≤‡∏Å `proceedWithDataCollection()` function:

```javascript
const batchData = [
  {
    "batch-company": "001",           // ‚Üí CompanyId (1=BJC, 2=BIGC)
    "batch-year": "2025",             // ‚Üí BudgetYear
    "batch-cobu": "BU01",             // ‚Üí Cobu
    "batch-cost-center": "CC100",     // ‚Üí CostCenterCode
    "batch-division": "DIV01",        // ‚Üí Division
    "batch-department": "DEPT01",     // ‚Üí Department
    "batch-section": "SEC01",         // ‚Üí Section
    "batch-position": "POS100",       // ‚Üí PositionCode
    "batch-job-band": "JB01",         // ‚Üí JobBand
    "batch-emp-status": "Active",     // ‚Üí EmpStatus
    "batch-join-date": "2025-01-01",  // ‚Üí JoinDate
    // ... LE Benefits (2025 Oct-Dec)
    "batchLe-payroll": "50000",
    "batchLe-premium": "5000",
    // ... Budget Year Benefits (2026)
    "batchBg-payroll": "60000",
    "batchBg-premium": "6000",
    // ... Dynamic Cost Center Allocation (if multi CC)
    // ... all other fields
  },
  // Row 2, Row 3, ...
]
```

### üóÑÔ∏è Database Structure Analysis

#### **Common Fields (Both BJC & BIGC):**

| Category | Fields | Required |
|----------|--------|----------|
| **Primary Key** | `BUDGET_ID` (auto-increment), `BUDGET_YEAR` | ‚úÖ Yes |
| **Company** | `COMPANY_ID`, `COMPANY_CODE` | ‚úÖ Yes |
| **Organization** | `BU`, `COBU`, `DIVISION`, `DEPARTMENT`, `SECTION`, `STORE_NAME` | Partial |
| **Employee** | `EMP_CODE`, `EMP_STATUS`, `EMP_TYPE_CODE` | ‚úÖ EMP_CODE Required |
| **Employee Name** | `TITLE_TH`, `FNAME_TH`, `LNAME_TH`, `TITLE_EN`, `FNAME_EN`, `LNAME_EN` | Optional |
| **Position** | `COST_CENTER_CODE`, `COST_CENTER_NAME`, `POSITION_CODE`, `POSITION_NAME`, `JOB_BAND` | ‚úÖ COST_CENTER_CODE Required |
| **Dates** | `JOIN_DATE`, `UPDATED_DATE` | Optional |
| **Years** | `YOS_CURR_YEAR`, `YOS_NEXT_YEAR` | Optional |
| **New HC** | `NEW_HC_CODE`, `NEW_VAC_PERIOD`, `NEW_VAC_LE`, `REASON` | Optional |
| **Group** | `GROUP_NAME`, `GROUP_LEVEL_1`, `GROUP_LEVEL_2`, `GROUP_LEVEL_3` | Optional |
| **HR** | `HRBP_EMP_CODE`, `RUNRATE_CODE` | Optional |
| **Config** | `COST_CENTER_PLAN`, `SALARY_STRUCTURE`, `DISCOUNT`, `EXECUTIVE`, `FOCUS_HC`, `FOCUS_PE`, `JOIN_PVF`, `PVF` | Optional |
| **Months** | `LE_OF_MONTH`, `NO_OF_MONTH` | Optional |
| **Audit** | `UPDATED_BY`, `UPDATED_DATE` | Recommended |

#### **Financial Fields Pattern:**

‡∏ó‡∏±‡πâ‡∏á BJC ‡πÅ‡∏•‡∏∞ BIGC ‡∏°‡∏µ pattern ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô:

- **LE (Last Estimate)** fields: `*_LE` (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö LE year, ‡πÄ‡∏ä‡πà‡∏ô 2025)
- **Current Year** fields: ‡πÑ‡∏°‡πà‡∏°‡∏µ suffix (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Budget year, ‡πÄ‡∏ä‡πà‡∏ô 2026)

#### **BJC-Specific Financial Fields (96 fields):**

<details>
<summary>üìä BJC Financial Fields (Click to expand)</summary>

| Field Group | LE Fields | Current Year Fields |
|-------------|-----------|---------------------|
| **Payroll** | `PAYROLL_LE`, `PREMIUM_LE` | `PAYROLL`, `PREMIUM` |
| **Salary** | `SAL_WITH_EN_LE`, `SAL_NOT_EN_LE`, `SAL_TEMP_LE` | `SAL_WITH_EN`, `SAL_NOT_EN`, `SAL_TEMP` |
| **Bonus** | `BONUS_TYPE_LE`, `BONUS_LE` | `BONUS_TYPE`, `BONUS` |
| **Social Security** | `SOCIAL_SECURITY_TMP_LE`, `SOCIAL_SECURITY_LE` | `SOCIAL_SECURITY_TMP`, `SOCIAL_SECURITY` |
| **Provident Fund** | `PROVIDENT_FUND_LE` | `PROVIDENT_FUND` |
| **Allowances** | `SALES_MANAGEMENT_PC_LE`, `SHELF_STACKING_PC_LE`, `DILIGENCE_ALLOWANCE_PC_LE`, `POST_ALLOWANCE_PC_LE`, `PHONE_ALLOWANCE_PC_LE`, `TRANSPORTATION_PC_LE`, `SKILL_ALLOWANCE_PC_LE`, `OTHER_ALLOWANCE_PC_LE` | Same without `_LE` |
| **Car Related** | `CAR_MAINTENANCE_TMP_LE`, `CAR_MAINTENANCE_LE`, `CAR_GASOLINE_LE`, `CAR_REPAIR_LE`, `CAR_RENTAL_LE`, `COMP_CARS_GAS_LE`, `COMP_CARS_OTHER_LE`, `CAR_ALLOWANCE_LE` | Same without `_LE` |
| **Staff Benefits** | `TEMPORARY_STAFF_SAL_LE`, `HOUSING_ALLOWANCE_LE`, `SALES_CAR_ALLOWANCE_LE`, `SOUTHRISK_ALLOWANCE_LE`, `SOUTHRISK_ALLOWANCE_TMP_LE`, `ACCOMMODATION_LE`, `MEAL_ALLOWANCE_LE` | Same without `_LE` |
| **Insurance** | `WORKMEN_COMPENSATION_LE`, `LIFE_INSURANCE_LE` | `WORKMEN_COMPENSATION`, `LIFE_INSURANCE` |
| **Medical** | `MEDICAL_OUTSIDE_LE`, `MEDICAL_INHOUSE_LE` | `MEDICAL_OUTSIDE`, `MEDICAL_INHOUSE` |
| **Others** | `STAFF_ACTIVITIES_LE`, `UNIFORM_LE`, `LICENSE_ALLOWANCE_LE`, `OUTSOURCE_WAGES_LE`, `OTHER_LE`, `OTHERS_SUBJECT_TAX_LE` | Same without `_LE` |
| **Performance** | `PE_MTH_LE`, `PE_YEAR_LE`, `PE_SB_MTH_LE`, `PE_SB_YEAR_LE` | `PE_MTH`, `PE_YEAR`, `PE_SB_MTH`, `PE_SB_YEAR` |

</details>

#### **BIGC-Specific Financial Fields (120+ fields):**

<details>
<summary>üìä BIGC Financial Fields (Click to expand)</summary>

**BIGC ‡∏°‡∏µ fields ‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å BJC:**

| Field Group | LE Fields | Current Year Fields |
|-------------|-----------|---------------------|
| **Payroll** | `PAYROLL_LE`, `PREMIUM_LE`, `TOTAL_PAYROLL_LE` | `PAYROLL`, `PREMIUM`, `TOTAL_PAYROLL` |
| **Bonus** | `BONUS_LE` | `BONUS`, `BONUS_TYPES` |
| **Car Related** | `FLEET_CARD_PE_LE`, `CAR_ALLOWANCE_LE`, `GASOLINE_ALLOWANCE_LE`, `CAR_RENTAL_PE_LE` | `FLEET_CARD_PE`, `CAR_ALLOWANCE`, `GASOLINE_ALLOWANCE`, `CAR_RENTAL_PE` |
| **Allowances** | `LICENSE_ALLOWANCE_LE`, `HOUSING_ALLOWANCE_LE`, `SKILL_PAY_ALLOWANCE_LE`, `OTHER_ALLOWANCE_LE` | `LICENSE_ALLOWANCE`, `HOUSING_ALLOWANCE`, `SKILL_PAY_ALLOWANCE`, `OTHER_ALLOWANCE` |
| **Student** | `WAGE_STUDENT_LE` | `WAGE_STUDENT` |
| **Social Security** | `SOCIAL_SECURITY_LE`, `LABOR_FUND_FEE_LE` | `SOCIAL_SECURITY`, `LABOR_FUND_FEE` |
| **Benefits** | `PROVIDENT_FUND_LE`, `EMPLOYEE_WELFARE_LE`, `OTHER_STAFF_BENEFIT_LE`, `STAFF_INSURANCE_LE` | `PROVIDENT_FUND`, `EMPLOYEE_WELFARE`, `OTHER_STAFF_BENEFIT`, `STAFF_INSURANCE` |
| **Medical** | `MEDICAL_EXPENSE_LE`, `MEDICAL_INHOUSE_LE` | `MEDICAL_EXPENSE`, `MEDICAL_INHOUSE` |
| **Others** | `TRAINING_LE`, `LONG_SERVICE_LE`, `PROVISION_LE`, `INTEREST_LE` | `TRAINING`, `LONG_SERVICE`, `PROVISION`, `INTEREST` |
| **Performance** | `PE_MTH_LE`, `PE_YEAR_LE`, `PE_SB_MTH_LE`, `PE_SB_YEAR_LE` | `PE_MTH`, `PE_YEAR`, `PE_SB_MTH`, `PE_SB_YEAR` |

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** BIGC ‡∏°‡∏µ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ 2 patterns (LE ‡πÅ‡∏•‡∏∞ Current Year) ‡πÑ‡∏°‡πà‡∏°‡∏µ Next Year (*_NX) fields

</details>

### üîÑ Field Mapping Strategy

**JavaScript Field Name ‚Üí Database Column:**

```javascript
// Pattern 1: Direct mapping with transform
"batch-company" ‚Üí COMPANY_ID (transform: "001" ‚Üí 1, "002" ‚Üí 2)

// Pattern 2: Remove "batch-" prefix
"batch-year" ‚Üí BUDGET_YEAR
"batch-cobu" ‚Üí COBU
"batch-cost-center" ‚Üí COST_CENTER_CODE

// Pattern 3: LE Benefits (remove "batchLe-" prefix + add "_LE" suffix)
"batchLe-payroll" ‚Üí PAYROLL_LE
"batchLe-premium" ‚Üí PREMIUM_LE

// Pattern 4: Budget Year Benefits (remove "batchBg-" prefix)
"batchBg-payroll" ‚Üí PAYROLL
"batchBg-premium" ‚Üí PREMIUM
```

---

## 3. ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö API Endpoint

### üîå Endpoint Specification

```http
POST /api/Budget/B0SaveBatchEntry
Content-Type: application/json
```

### üì• Request Model

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà:** `DTOs/Budget/BatchBudgetRequest.cs`

```csharp
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;

namespace HCBPCoreUI_Backend.DTOs.Budget
{
    /// <summary>
    /// Request DTO for batch budget creation
    /// </summary>
    public class BatchBudgetRequest
    {
        /// <summary>
        /// List of budget entries to create
        /// </summary>
        [Required]
        [MinLength(1, ErrorMessage = "At least one budget entry is required")]
        public List<BudgetResponseDto> Budgets { get; set; } = new();

        /// <summary>
        /// Optional: User who initiated the batch save
        /// </summary>
        public string? CreatedBy { get; set; }
    }
}
```

### üì§ Response Model

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà:** `DTOs/Budget/BatchBudgetResponse.cs`

```csharp
using System.Collections.Generic;

namespace HCBPCoreUI_Backend.DTOs.Budget
{
    /// <summary>
    /// Response DTO for batch budget creation
    /// </summary>
    public class BatchBudgetResponse
    {
        /// <summary>
        /// Overall success status
        /// </summary>
        public bool Success { get; set; }

        /// <summary>
        /// Summary message
        /// </summary>
        public string Message { get; set; } = string.Empty;

        /// <summary>
        /// Total number of rows submitted
        /// </summary>
        public int TotalSubmitted { get; set; }

        /// <summary>
        /// Number of successfully saved rows
        /// </summary>
        public int TotalSuccess { get; set; }

        /// <summary>
        /// Number of failed rows
        /// </summary>
        public int TotalFailed { get; set; }

        /// <summary>
        /// Successfully created budgets with their new IDs
        /// </summary>
        public List<BudgetSaveResult> SuccessResults { get; set; } = new();

        /// <summary>
        /// Failed budget entries with error details
        /// </summary>
        public List<BudgetSaveError> FailedResults { get; set; } = new();
    }

    /// <summary>
    /// Individual budget save result
    /// </summary>
    public class BudgetSaveResult
    {
        /// <summary>
        /// Row index (0-based) from submitted batch
        /// </summary>
        public int RowIndex { get; set; }

        /// <summary>
        /// Generated Budget ID
        /// </summary>
        public int BudgetId { get; set; }

        /// <summary>
        /// Employee Code
        /// </summary>
        public string? EmpCode { get; set; }

        /// <summary>
        /// Cost Center Code
        /// </summary>
        public string? CostCenterCode { get; set; }

        /// <summary>
        /// Budget Year
        /// </summary>
        public int BudgetYear { get; set; }

        /// <summary>
        /// Company ID
        /// </summary>
        public int? CompanyId { get; set; }
    }

    /// <summary>
    /// Individual budget save error
    /// </summary>
    public class BudgetSaveError
    {
        /// <summary>
        /// Row index (0-based) from submitted batch
        /// </summary>
        public int RowIndex { get; set; }

        /// <summary>
        /// Employee Code (if available)
        /// </summary>
        public string? EmpCode { get; set; }

        /// <summary>
        /// Error message
        /// </summary>
        public string ErrorMessage { get; set; } = string.Empty;

        /// <summary>
        /// Error details
        /// </summary>
        public string? ErrorDetails { get; set; }

        /// <summary>
        /// Submitted data (for debugging)
        /// </summary>
        public object? SubmittedData { get; set; }
    }
}
```

---

## 4. Data Flow Architecture

### üìä Complete Data Flow Diagram

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ FRONTEND (budget.plan.events.js)                                   ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ  proceedWithDataCollection(validationResults) {                    ‚îÇ
‚îÇ    1. Collect batchData from all rows                              ‚îÇ
‚îÇ    2. Call saveBatchBudgetData(batchData)  ‚Üê NEW FUNCTION          ‚îÇ
‚îÇ  }                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
                  üåê HTTP POST Request
                  /api/Budget/B0SaveBatchEntry
                  Content-Type: application/json
                  Body: { Budgets: [...], CreatedBy: "user" }
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ BACKEND: BudgetController.cs                                        ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ  [HttpPost("B0SaveBatchEntry")]                                     ‚îÇ
‚îÇ  public async Task<IActionResult> SaveBatchEntry(                  ‚îÇ
‚îÇ    [FromBody] BatchBudgetRequest request                           ‚îÇ
‚îÇ  ) {                                                                ‚îÇ
‚îÇ    1. ‚úÖ Validate request (ModelState)                             ‚îÇ
‚îÇ    2. ‚úÖ Check budgets list not empty                              ‚îÇ
‚îÇ    3. üìû Call _budgetService.CreateBatchBudgetsAsync()             ‚îÇ
‚îÇ    4. üì§ Return BatchBudgetResponse                                ‚îÇ
‚îÇ  }                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ BACKEND: BudgetService.cs                                           ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ  public async Task<BatchBudgetResponse> CreateBatchBudgetsAsync(   ‚îÇ
‚îÇ    List<BudgetResponseDto> budgets, string createdBy              ‚îÇ
‚îÇ  ) {                                                                ‚îÇ
‚îÇ    var response = new BatchBudgetResponse();                       ‚îÇ
‚îÇ    var successList = new List<BudgetSaveResult>();                 ‚îÇ
‚îÇ    var errorList = new List<BudgetSaveError>();                    ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ    üîÅ foreach (budget in budgets with index) {                     ‚îÇ
‚îÇ      try {                                                          ‚îÇ
‚îÇ        1. üîç Extract CompanyId from budget                         ‚îÇ
‚îÇ        2. üîÄ Route to correct table:                               ‚îÇ
‚îÇ           if (companyId == 1) ‚Üí CreateBjcBudgetAsync()            ‚îÇ
‚îÇ           if (companyId == 2) ‚Üí CreateBigcBudgetAsync()           ‚îÇ
‚îÇ        3. ‚úÖ Add to successList                                    ‚îÇ
‚îÇ      }                                                              ‚îÇ
‚îÇ      catch (Exception ex) {                                         ‚îÇ
‚îÇ        ‚ùå Add to errorList with details                            ‚îÇ
‚îÇ      }                                                              ‚îÇ
‚îÇ    }                                                                ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ    üìä Build response summary                                        ‚îÇ
‚îÇ    return response;                                                 ‚îÇ
‚îÇ  }                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ                               ‚îÇ
            ‚Üì                               ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ CreateBjcBudgetAsync ‚îÇ       ‚îÇ CreateBigcBudgetAsync‚îÇ
‚îÇ                      ‚îÇ       ‚îÇ                      ‚îÇ
‚îÇ 1. Map DTO ‚Üí Entity  ‚îÇ       ‚îÇ 1. Map DTO ‚Üí Entity  ‚îÇ
‚îÇ 2. _context.Add()    ‚îÇ       ‚îÇ 2. _context.Add()    ‚îÇ
‚îÇ 3. SaveChangesAsync()‚îÇ       ‚îÇ 3. SaveChangesAsync()‚îÇ
‚îÇ 4. Return created DTO‚îÇ       ‚îÇ 4. Return created DTO‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚Üì                               ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ HRB_BUDGET_BJC       ‚îÇ       ‚îÇ HRB_BUDGET_BIGC      ‚îÇ
‚îÇ (SQL Server Table)   ‚îÇ       ‚îÇ (SQL Server Table)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üîÑ Detailed Service Logic

```csharp
public async Task<BatchBudgetResponse> CreateBatchBudgetsAsync(
    List<BudgetResponseDto> budgets, 
    string createdBy)
{
    var response = new BatchBudgetResponse
    {
        TotalSubmitted = budgets.Count
    };

    for (int i = 0; i < budgets.Count; i++)
    {
        var budget = budgets[i];
        try
        {
            // Set audit fields
            budget.UpdatedBy = createdBy ?? "System";
            budget.UpdatedDate = DateTime.Now;

            // Validate CompanyId
            if (!budget.CompanyId.HasValue || 
                (budget.CompanyId != 1 && budget.CompanyId != 2))
            {
                throw new ArgumentException(
                    $"Invalid CompanyId: {budget.CompanyId}. Must be 1 (BJC) or 2 (BIGC)."
                );
            }

            // Route to correct table
            object createdBudget;
            if (budget.CompanyId == 1) // BJC
            {
                var bjcDto = MapToBjcDto(budget);
                createdBudget = await CreateBjcBudgetAsync(bjcDto);
            }
            else // BIGC
            {
                var bigcDto = MapToBigcDto(budget);
                createdBudget = await CreateBigcBudgetAsync(bigcDto);
            }

            // Extract BudgetId from created entity
            int budgetId = GetBudgetIdFromCreatedEntity(createdBudget);

            // Add to success list
            response.SuccessResults.Add(new BudgetSaveResult
            {
                RowIndex = i,
                BudgetId = budgetId,
                EmpCode = budget.EmpCode,
                CostCenterCode = budget.CostCenterCode,
                BudgetYear = budget.BudgetYear,
                CompanyId = budget.CompanyId
            });
            response.TotalSuccess++;
        }
        catch (Exception ex)
        {
            // Add to error list
            response.FailedResults.Add(new BudgetSaveError
            {
                RowIndex = i,
                EmpCode = budget.EmpCode,
                ErrorMessage = ex.Message,
                ErrorDetails = ex.InnerException?.Message,
                SubmittedData = budget // For debugging
            });
            response.TotalFailed++;
        }
    }

    // Set overall status
    response.Success = response.TotalFailed == 0;
    response.Message = response.Success
        ? $"Successfully saved {response.TotalSuccess} budget entries."
        : $"Saved {response.TotalSuccess} entries with {response.TotalFailed} failures.";

    return response;
}
```

---

## 5. Transaction Management

### üîí Transaction Strategy

**Option 1: Individual Transactions (RECOMMENDED)**

```csharp
// ‚úÖ Pros:
// - Partial success possible (some rows saved even if others fail)
// - Better error reporting (which specific rows failed)
// - No rollback of successful rows

// ‚ùå Cons:
// - Not truly atomic (batch not "all or nothing")
// - Potential for partial data in DB

foreach (var budget in budgets)
{
    try
    {
        // Each save is its own transaction
        var created = await CreateBudgetAsync(budget, companyId);
        successList.Add(created);
    }
    catch (Exception ex)
    {
        errorList.Add(new BudgetSaveError { ... });
    }
}
```

**Option 2: Single Transaction (Alternative)**

```csharp
// ‚úÖ Pros:
// - Truly atomic ("all or nothing")
// - Data consistency guaranteed

// ‚ùå Cons:
// - One failure = all fail (lose all work)
// - Harder to report which specific row caused failure

using var transaction = await _context.Database.BeginTransactionAsync();
try
{
    foreach (var budget in budgets)
    {
        await CreateBudgetAsync(budget, companyId);
    }
    await transaction.CommitAsync();
    return SuccessResponse();
}
catch (Exception ex)
{
    await transaction.RollbackAsync();
    return ErrorResponse(ex);
}
```

**üìå Recommended Approach: Option 1 (Individual Transactions)**

**‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:**
1. ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏≤‡∏ö‡∏ß‡πà‡∏≤‡πÅ‡∏ñ‡∏ß‡πÑ‡∏´‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏ñ‡∏ß‡πÑ‡∏´‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
2. Frontend ‡∏°‡∏µ validation ‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∂‡∏á‡πÇ‡∏≠‡∏Å‡∏≤‡∏™ error ‡∏ï‡πà‡∏≥
3. ‡∏ñ‡πâ‡∏≤ 1 ‡πÅ‡∏ñ‡∏ß‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÅ‡∏ñ‡∏ß‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢
4. User experience ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ (partial success > total failure)

---

## 6. Error Handling Strategy

### üõ°Ô∏è Error Categories

| Category | HTTP Status | Handling Strategy |
|----------|-------------|-------------------|
| **Validation Error** | 400 Bad Request | Return detailed field errors |
| **Business Rule Error** | 400 Bad Request | Return specific rule violation |
| **Database Error** | 500 Internal Server Error | Log error, return generic message |
| **Duplicate Entry** | 409 Conflict | Return conflicting key info |
| **Authorization Error** | 403 Forbidden | Return access denied message |

### üìù Error Response Format

```json
{
  "success": false,
  "message": "Batch save completed with errors",
  "totalSubmitted": 5,
  "totalSuccess": 3,
  "totalFailed": 2,
  "successResults": [ /* ... */ ],
  "failedResults": [
    {
      "rowIndex": 1,
      "empCode": "E001",
      "errorMessage": "Duplicate entry: Employee E001 already exists for Budget Year 2026",
      "errorDetails": "Unique constraint violation on (EMP_CODE, BUDGET_YEAR, COST_CENTER_CODE)",
      "submittedData": { /* budget data for debugging */ }
    },
    {
      "rowIndex": 3,
      "empCode": "E003",
      "errorMessage": "Invalid CompanyId: 3. Must be 1 (BJC) or 2 (BIGC).",
      "errorDetails": null,
      "submittedData": { /* budget data for debugging */ }
    }
  ]
}
```

### üîç Common Error Scenarios

```csharp
// 1. Empty batch list
if (request.Budgets == null || request.Budgets.Count == 0)
{
    return BadRequest(new {
        Success = false,
        Message = "Budgets list cannot be empty"
    });
}

// 2. Invalid CompanyId
if (!budget.CompanyId.HasValue || 
    (budget.CompanyId != 1 && budget.CompanyId != 2))
{
    throw new ArgumentException(
        $"Invalid CompanyId: {budget.CompanyId}. Must be 1 (BJC) or 2 (BIGC)."
    );
}

// 3. Missing required fields
if (string.IsNullOrEmpty(budget.EmpCode))
{
    throw new ArgumentException("Employee Code is required.");
}

if (string.IsNullOrEmpty(budget.CostCenterCode))
{
    throw new ArgumentException("Cost Center Code is required.");
}

if (budget.BudgetYear <= 0)
{
    throw new ArgumentException("Budget Year is required.");
}

// 4. Duplicate entry (DB unique constraint)
catch (DbUpdateException ex) when (ex.InnerException is SqlException sqlEx && 
    sqlEx.Number == 2627) // Unique constraint violation
{
    throw new ArgumentException(
        $"Duplicate entry: Employee {budget.EmpCode} already exists for Budget Year {budget.BudgetYear}"
    );
}

// 5. Database connection error
catch (DbUpdateException ex)
{
    Console.WriteLine($"Database error: {ex.Message}");
    throw new InvalidOperationException(
        "An error occurred while saving to database. Please try again."
    );
}
```

---

## 7. Implementation Plan

### üìã Phase 1: Backend Setup (Day 1-2)

#### **Task 1.1: Create DTOs**
- [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á `DTOs/Budget/BatchBudgetRequest.cs`
- [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á `DTOs/Budget/BatchBudgetResponse.cs`
- [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á `DTOs/Budget/BudgetSaveResult.cs` (inner class)
- [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á `DTOs/Budget/BudgetSaveError.cs` (inner class)

#### **Task 1.2: Update IBudgetService Interface**
```csharp
Task<BatchBudgetResponse> CreateBatchBudgetsAsync(
    List<BudgetResponseDto> budgets, 
    string createdBy
);
```

#### **Task 1.3: Implement BudgetService Method**

**‚ö†Ô∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** Implementation ‡∏à‡∏∞‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏ï‡∏≤‡∏° SA ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° Q6 (Duplicate Check Strategy)

<details>
<summary><strong>Option A: No Pre-Check (Rely on DB Constraint)</strong></summary>

```csharp
// File: Services/BudgetService.cs
// Location: After UpdateBudgetAsync() method

public async Task<BatchBudgetResponse> CreateBatchBudgetsAsync(
    List<BudgetResponseDto> budgets, 
    string createdBy)
{
    var response = new BatchBudgetResponse
    {
        TotalSubmitted = budgets.Count
    };

    for (int i = 0; i < budgets.Count; i++)
    {
        var budget = budgets[i];
        try
        {
            budget.UpdatedBy = createdBy ?? "System";
            budget.UpdatedDate = DateTime.Now;

            // Validate CompanyId
            if (!budget.CompanyId.HasValue || 
                (budget.CompanyId != 1 && budget.CompanyId != 2))
            {
                throw new ArgumentException(
                    $"Invalid CompanyId: {budget.CompanyId}. Must be 1 (BJC) or 2 (BIGC)."
                );
            }

            // Route to correct table
            object createdBudget;
            if (budget.CompanyId == 1)
            {
                var bjcDto = MapToBjcDto(budget);
                createdBudget = await CreateBjcBudgetAsync(bjcDto);
            }
            else
            {
                var bigcDto = MapToBigcDto(budget);
                createdBudget = await CreateBigcBudgetAsync(bigcDto);
            }

            int budgetId = GetBudgetIdFromCreatedEntity(createdBudget);

            response.SuccessResults.Add(new BudgetSaveResult
            {
                RowIndex = i,
                BudgetId = budgetId,
                EmpCode = budget.EmpCode,
                CostCenterCode = budget.CostCenterCode,
                BudgetYear = budget.BudgetYear,
                CompanyId = budget.CompanyId
            });
            response.TotalSuccess++;
        }
        catch (DbUpdateException ex) when (ex.InnerException is SqlException sqlEx && 
            sqlEx.Number == 2627) // Unique constraint violation
        {
            response.FailedResults.Add(new BudgetSaveError
            {
                RowIndex = i,
                EmpCode = budget.EmpCode,
                ErrorMessage = $"Duplicate entry: Employee {budget.EmpCode} already exists for Budget Year {budget.BudgetYear}",
                ErrorDetails = "Unique constraint violation"
            });
            response.TotalFailed++;
        }
        catch (Exception ex)
        {
            response.FailedResults.Add(new BudgetSaveError
            {
                RowIndex = i,
                EmpCode = budget.EmpCode,
                ErrorMessage = ex.Message,
                ErrorDetails = ex.InnerException?.Message
            });
            response.TotalFailed++;
        }
    }

    response.Success = response.TotalFailed == 0;
    response.Message = response.Success
        ? $"Successfully saved {response.TotalSuccess} budget entries."
        : $"Saved {response.TotalSuccess} entries with {response.TotalFailed} failures.";

    return response;
}
```

</details>

<details>
<summary><strong>‚≠ê Option B: Pre-Check Duplicates (RECOMMENDED for Better UX)</strong></summary>

```csharp
// File: Services/BudgetService.cs
// Location: After UpdateBudgetAsync() method

public async Task<BatchBudgetResponse> CreateBatchBudgetsAsync(
    List<BudgetResponseDto> budgets, 
    string createdBy)
{
    var response = new BatchBudgetResponse
    {
        TotalSubmitted = budgets.Count
    };

    for (int i = 0; i < budgets.Count; i++)
    {
        var budget = budgets[i];
        try
        {
            budget.UpdatedBy = createdBy ?? "System";
            budget.UpdatedDate = DateTime.Now;

            // Validate CompanyId
            if (!budget.CompanyId.HasValue || 
                (budget.CompanyId != 1 && budget.CompanyId != 2))
            {
                throw new ArgumentException(
                    $"Invalid CompanyId: {budget.CompanyId}. Must be 1 (BJC) or 2 (BIGC)."
                );
            }

            // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
            // üîç OPTION B: PRE-CHECK DUPLICATE
            // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
            bool isDuplicate = false;
            if (budget.CompanyId == 1) // BJC
            {
                isDuplicate = await _context.HRB_BUDGET_BJC
                    .AnyAsync(b => 
                        b.EmpCode == budget.EmpCode && 
                        b.BudgetYear == budget.BudgetYear &&
                        b.CostCenterCode == budget.CostCenterCode
                    );
            }
            else // BIGC
            {
                isDuplicate = await _context.HRB_BUDGET_BIGC
                    .AnyAsync(b => 
                        b.EmpCode == budget.EmpCode && 
                        b.BudgetYear == budget.BudgetYear &&
                        b.CostCenterCode == budget.CostCenterCode
                    );
            }

            if (isDuplicate)
            {
                throw new DuplicateBudgetException(
                    $"‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏´‡∏±‡∏™ {budget.EmpCode} ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏õ‡∏µ {budget.BudgetYear} " +
                    $"‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Cost Center {budget.CostCenterCode} ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß",
                    budget.EmpCode,
                    budget.BudgetYear,
                    budget.CostCenterCode
                );
            }
            // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

            // Route to correct table
            object createdBudget;
            if (budget.CompanyId == 1)
            {
                var bjcDto = MapToBjcDto(budget);
                createdBudget = await CreateBjcBudgetAsync(bjcDto);
            }
            else
            {
                var bigcDto = MapToBigcDto(budget);
                createdBudget = await CreateBigcBudgetAsync(bigcDto);
            }

            int budgetId = GetBudgetIdFromCreatedEntity(createdBudget);

            response.SuccessResults.Add(new BudgetSaveResult
            {
                RowIndex = i,
                BudgetId = budgetId,
                EmpCode = budget.EmpCode,
                CostCenterCode = budget.CostCenterCode,
                BudgetYear = budget.BudgetYear,
                CompanyId = budget.CompanyId
            });
            response.TotalSuccess++;
        }
        catch (DuplicateBudgetException ex)
        {
            // Handle duplicate with clear Thai message
            response.FailedResults.Add(new BudgetSaveError
            {
                RowIndex = i,
                EmpCode = budget.EmpCode,
                ErrorMessage = ex.Message, // Thai message
                ErrorDetails = $"Duplicate: {ex.EmpCode} | Year: {ex.BudgetYear} | CC: {ex.CostCenterCode}",
                SubmittedData = budget
            });
            response.TotalFailed++;
        }
        catch (Exception ex)
        {
            response.FailedResults.Add(new BudgetSaveError
            {
                RowIndex = i,
                EmpCode = budget.EmpCode,
                ErrorMessage = ex.Message,
                ErrorDetails = ex.InnerException?.Message,
                SubmittedData = budget
            });
            response.TotalFailed++;
        }
    }

    response.Success = response.TotalFailed == 0;
    response.Message = response.Success
        ? $"Successfully saved {response.TotalSuccess} budget entries."
        : $"Saved {response.TotalSuccess} entries with {response.TotalFailed} failures.";

    return response;
}

// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
// üéØ Custom Exception for Option B
// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
public class DuplicateBudgetException : Exception
{
    public string EmpCode { get; }
    public int BudgetYear { get; }
    public string CostCenterCode { get; }

    public DuplicateBudgetException(
        string message, 
        string empCode, 
        int budgetYear, 
        string costCenterCode
    ) : base(message)
    {
        EmpCode = empCode;
        BudgetYear = budgetYear;
        CostCenterCode = costCenterCode;
    }
}
```

**üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ Option B:**
- ‡πÉ‡∏ä‡πâ `AnyAsync()` ‡πÅ‡∏ó‡∏ô `FirstOrDefaultAsync()` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß
- Error message ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
- Custom exception ‡πÄ‡∏Å‡πá‡∏ö context ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö debugging
- Performance: ~150-200ms per row (vs 100ms Option A)

</details>



#### **Task 1.4: Add Controller Endpoint**
```csharp
// File: Controllers/BudgetController.cs
// Location: After DeleteBudget() method

[HttpPost]
[Route("B0SaveBatchEntry")]
public async Task<IActionResult> SaveBatchEntry(
    [FromBody] BatchBudgetRequest request)
{
    // Implementation as per Section 3
}
```

### üìã Phase 2: Frontend Integration (Day 3)

#### **Task 2.1: Create API Call Function**
```javascript
// File: wwwroot/lib/razor/js/budget-planning/budget.plan.api.js
// Location: Add after existing budget API calls

/**
 * üíæ Save Batch Budget Entries
 * @param {Array} batchData - Array of budget objects
 * @returns {Promise<Object>} Batch save response
 */
async function saveBatchBudgetData(batchData) {
  try {
    console.log('üì§ Sending batch save request...', {
      totalRows: batchData.length,
      data: batchData
    });

    const response = await fetch('/api/Budget/B0SaveBatchEntry', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        budgets: batchData,
        createdBy: 'CurrentUser' // TODO: Get from authentication
      })
    });

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.message || 'Failed to save batch entries');
    }

    const result = await response.json();
    console.log('‚úÖ Batch save response:', result);
    
    return result;
  } catch (error) {
    console.error('‚ùå Batch save error:', error);
    throw error;
  }
}
```

#### **Task 2.2: Update proceedWithDataCollection()**

**‚ö†Ô∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** Loading message ‡∏à‡∏∞‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏ï‡∏≤‡∏° SA ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° Q6 (Duplicate Check Strategy)

```javascript
// File: wwwroot/lib/razor/js/budget-planning/budget.plan.events.js
// Location: Replace setTimeout simulation (Lines 5011-5015)

proceedWithDataCollection: async function (validationResults) {
  console.log('üì¶ Collecting data from all valid rows...');

  // Collect all data from valid rows
  const batchData = [];
  this.activeRows.forEach((rowData, rowId) => {
    const data = this.collectRowData(rowId);
    if (data) {
      batchData.push(data);
    }
  });

  if (batchData.length === 0) {
    console.error('‚ùå No valid data collected for saving');
    return;
  }

  // Show success message with validation summary
  const container = document.getElementById('batchValidationMessages');
  if (container) {
    const successDiv = document.createElement('div');
    successDiv.className = 'alert alert-success mt-2';
    successDiv.innerHTML = `
      <h6 class="alert-heading">
        <i class="fas fa-check-circle me-2"></i>Ready to Save!
      </h6>
      <p class="mb-2">All validation passed. Preparing to save ${batchData.length} rows...</p>
      ${validationResults.summary.totalWarnings > 0 ?
        `<small class="text-muted">Note: ${validationResults.summary.totalWarnings} warnings found but ignored.</small>` : ''}
    `;
    container.appendChild(successDiv);
  }

  console.log('üìä Enhanced batch data to save:', {
    totalRows: batchData.length,
    validationSummary: validationResults.summary,
    data: batchData
  });

  // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
  // üéØ NEW: Call actual API instead of setTimeout simulation
  // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
  try {
    // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    // üîç LOADING MESSAGE (‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏ï‡∏≤‡∏° Q6 Answer)
    // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    
    // Option A: No Pre-Check
    // this.showLoadingOverlay('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
    
    // Option B: Pre-Check (RECOMMENDED) ‚≠ê
    this.showLoadingOverlay('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...');
    
    // Optional: Performance warning for large batch
    if (batchData.length > 20) {
      console.warn(`‚ö†Ô∏è Large batch detected (${batchData.length} rows). Processing may take longer.`);
    }
    // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

    // Call API
    const response = await saveBatchBudgetData(batchData);

    // Hide loading
    this.hideLoadingOverlay();

    // Handle response
    if (response.success && response.totalFailed === 0) {
      // ‚úÖ All successful
      this.showConfirmModal({
        title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
        message: `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${response.totalSuccess} ‡πÅ‡∏ñ‡∏ß!\n\n‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`,
        iconType: 'success',
        confirmText: '‡∏ï‡∏Å‡∏•‡∏á',
        showCancel: false,
        onConfirm: () => {
          this.cancelBatchEntry(); // Clear and close
          console.log(`‚úÖ Successfully saved ${response.totalSuccess} budget rows`);
        }
      });
    } 
    else if (response.totalSuccess > 0 && response.totalFailed > 0) {
      // ‚ö†Ô∏è Partial success
      this.showConfirmModal({
        title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
        message: `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${response.totalSuccess} ‡πÅ‡∏ñ‡∏ß\n‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ${response.totalFailed} ‡πÅ‡∏ñ‡∏ß\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î`,
        iconType: 'warning',
        confirmText: '‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î',
        showCancel: true,
        cancelText: '‡∏õ‡∏¥‡∏î',
        onConfirm: () => {
          this.showBatchErrorDetails(response.failedResults);
        }
      });
    }
    else {
      // ‚ùå All failed
      this.showConfirmModal({
        title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß',
        message: `‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ${response.totalFailed} ‡πÅ‡∏ñ‡∏ß\n\n${response.message}`,
        iconType: 'error',
        confirmText: '‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î',
        showCancel: true,
        cancelText: '‡∏õ‡∏¥‡∏î',
        onConfirm: () => {
          this.showBatchErrorDetails(response.failedResults);
        }
      });
    }
  } 
  catch (error) {
    // Hide loading
    this.hideLoadingOverlay();

    // Show error modal
    this.showConfirmModal({
      title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
      message: `‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á\n\nError: ${error.message}`,
      iconType: 'error',
      confirmText: '‡∏ï‡∏Å‡∏•‡∏á',
      showCancel: false
    });

    console.error('‚ùå Batch save failed:', error);
  }
},
```

#### **Task 2.3: Add Helper Methods**

**‚ö†Ô∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** Error display ‡∏à‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Option B (Duplicate Check)

```javascript
// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
// üéØ OPTION A: Simple Error Display
// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
showBatchErrorDetails_OptionA: function (failedResults) {
  const container = document.getElementById('batchValidationMessages');
  if (!container) return;

  const errorDiv = document.createElement('div');
  errorDiv.className = 'alert alert-danger mt-2';
  errorDiv.innerHTML = `
    <h6 class="alert-heading">
      <i class="fas fa-exclamation-circle me-2"></i>
      ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (${failedResults.length} ‡πÅ‡∏ñ‡∏ß)
    </h6>
    <ul class="mb-0">
      ${failedResults.map(error => `
        <li>
          <strong>‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà ${error.rowIndex + 1}</strong>
          ${error.empCode ? `(${error.empCode})` : ''}: 
          ${error.errorMessage}
        </li>
      `).join('')}
    </ul>
  `;
  container.appendChild(errorDiv);
  container.scrollIntoView({ behavior: 'smooth', block: 'start' });
},

// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
// üéØ OPTION B: Enhanced Error Display with Grouping ‚≠ê RECOMMENDED
// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
showBatchErrorDetails: function (failedResults) {
  const container = document.getElementById('batchValidationMessages');
  if (!container) return;

  // Group errors by type
  const duplicateErrors = failedResults.filter(e => 
    e.errorMessage.includes('‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß') || 
    e.errorMessage.includes('Duplicate')
  );
  const validationErrors = failedResults.filter(e => 
    e.errorMessage.includes('required') || 
    e.errorMessage.includes('Invalid')
  );
  const otherErrors = failedResults.filter(e => 
    !duplicateErrors.includes(e) && !validationErrors.includes(e)
  );

  let errorHtml = `
    <div class="alert alert-danger mt-2">
      <h6 class="alert-heading">
        <i class="fas fa-exclamation-circle me-2"></i>
        ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (${failedResults.length} ‡πÅ‡∏ñ‡∏ß)
      </h6>
  `;

  // Duplicate Errors Section
  if (duplicateErrors.length > 0) {
    errorHtml += `
      <div class="mt-3">
        <h6 class="text-warning">
          <i class="fas fa-copy me-2"></i>
          ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥ (${duplicateErrors.length} ‡πÅ‡∏ñ‡∏ß)
        </h6>
        <ul class="mb-0">
          ${duplicateErrors.map(error => `
            <li>
              <strong>‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà ${error.rowIndex + 1}</strong>
              ${error.empCode ? `<span class="badge bg-secondary">${error.empCode}</span>` : ''}: 
              ${error.errorMessage}
              ${error.errorDetails ? `<br><small class="text-muted">${error.errorDetails}</small>` : ''}
            </li>
          `).join('')}
        </ul>
      </div>
    `;
  }

  // Validation Errors Section
  if (validationErrors.length > 0) {
    errorHtml += `
      <div class="mt-3">
        <h6 class="text-danger">
          <i class="fas fa-exclamation-triangle me-2"></i>
          ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (${validationErrors.length} ‡πÅ‡∏ñ‡∏ß)
        </h6>
        <ul class="mb-0">
          ${validationErrors.map(error => `
            <li>
              <strong>‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà ${error.rowIndex + 1}</strong>
              ${error.empCode ? `<span class="badge bg-secondary">${error.empCode}</span>` : ''}: 
              ${error.errorMessage}
            </li>
          `).join('')}
        </ul>
      </div>
    `;
  }

  // Other Errors Section
  if (otherErrors.length > 0) {
    errorHtml += `
      <div class="mt-3">
        <h6 class="text-danger">
          <i class="fas fa-times-circle me-2"></i>
          ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏≠‡∏∑‡πà‡∏ô‡πÜ (${otherErrors.length} ‡πÅ‡∏ñ‡∏ß)
        </h6>
        <ul class="mb-0">
          ${otherErrors.map(error => `
            <li>
              <strong>‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà ${error.rowIndex + 1}</strong>
              ${error.empCode ? `<span class="badge bg-secondary">${error.empCode}</span>` : ''}: 
              ${error.errorMessage}
            </li>
          `).join('')}
        </ul>
      </div>
    `;
  }

  errorHtml += `</div>`;
  
  const errorDiv = document.createElement('div');
  errorDiv.innerHTML = errorHtml;
  container.appendChild(errorDiv);
  container.scrollIntoView({ behavior: 'smooth', block: 'start' });
},
// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

// Show/hide loading overlay
showLoadingOverlay: function (message = 'Loading...') {
  const overlay = document.getElementById('loadingOverlay');
  if (overlay) {
    const textElement = overlay.querySelector('#loadingText');
    if (textElement) {
      textElement.textContent = message;
      textElement.style.display = 'block';
    }
    overlay.classList.remove('d-none');
  }
},

hideLoadingOverlay: function () {
  const overlay = document.getElementById('loadingOverlay');
  if (overlay) {
    overlay.classList.add('d-none');
  }
}
```

### üìã Phase 3: Testing (Day 4-5)

#### **Unit Tests**
- [ ] Test `CreateBatchBudgetsAsync()` with valid data
- [ ] Test with invalid CompanyId
- [ ] Test with missing required fields
- [ ] Test with duplicate entries
- [ ] Test with partial success scenario
- [ ] **‚≠ê (Option B only)** Test duplicate check performance
- [ ] **‚≠ê (Option B only)** Test Thai error messages for duplicates

#### **Integration Tests**
- [ ] Test full API endpoint `/api/Budget/B0SaveBatchEntry`
- [ ] Test with 1 row
- [ ] Test with 10 rows
- [ ] Test with 50 rows (performance)
- [ ] Test error response format

#### **Frontend Tests**
- [ ] Test successful batch save
- [ ] Test partial success (some rows fail)
- [ ] Test all rows fail
- [ ] Test network error
- [ ] Test loading overlay display
- [ ] **‚≠ê (Option B only)** Test loading message shows "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å..."
- [ ] **‚≠ê (Option B only)** Test error grouping (duplicate vs validation vs other)
- [ ] **‚≠ê (Option B only)** Test performance warning for large batch (>20 rows)

### üìã Phase 4: Documentation & Deployment (Day 6)

- [ ] Update API documentation
- [ ] Update SAVE_ALL_BUTTON_WORKFLOW.md
- [ ] Create user guide for error handling
- [ ] Deploy to staging
- [ ] UAT testing with SA
- [ ] Deploy to production

---

## 8. Testing Strategy

### üß™ Test Cases

#### **TC-001: Success - All Rows Valid (BJC)**
```json
Request:
{
  "budgets": [
    {
      "companyId": 1,
      "budgetYear": 2026,
      "empCode": "E001",
      "costCenterCode": "CC001",
      // ... all required fields
    }
  ],
  "createdBy": "TestUser"
}

Expected Response:
{
  "success": true,
  "message": "Successfully saved 1 budget entries.",
  "totalSubmitted": 1,
  "totalSuccess": 1,
  "totalFailed": 0,
  "successResults": [
    {
      "rowIndex": 0,
      "budgetId": 1001,
      "empCode": "E001",
      "costCenterCode": "CC001",
      "budgetYear": 2026,
      "companyId": 1
    }
  ],
  "failedResults": []
}
```

#### **TC-002: Success - All Rows Valid (BIGC)**
```json
Request:
{
  "budgets": [
    {
      "companyId": 2,
      "budgetYear": 2026,
      "empCode": "E002",
      "costCenterCode": "CC002",
      // ... all required fields
    }
  ],
  "createdBy": "TestUser"
}

Expected: HTTP 200, success=true
```

#### **TC-003: Partial Success - Same Company with 1 Duplicate**
```json
Request:
{
  "budgets": [
    { "companyId": 1, "empCode": "E001", "budgetYear": 2026, ... }, // Valid BJC
    { "companyId": 1, "empCode": "E002", "budgetYear": 2026, ... }, // Valid BJC
    { "companyId": 1, "empCode": "E001", "budgetYear": 2026, ... }  // Duplicate E001
  ]
}

Expected Response:
{
  "success": false,
  "totalSubmitted": 3,
  "totalSuccess": 2,
  "totalFailed": 1,
  "failedResults": [
    {
      "rowIndex": 2,
      "empCode": "E001",
      "errorMessage": "Duplicate entry: Employee E001 already exists for Budget Year 2026"
    }
  ]
}
```

#### **TC-004: Validation Error - Missing Required Field**
```json
Request:
{
  "budgets": [
    {
      "companyId": 1,
      "budgetYear": 2026,
      // Missing empCode
      "costCenterCode": "CC001"
    }
  ]
}

Expected: HTTP 400 Bad Request
```

#### **TC-005: Duplicate Entry**
```json
// Assume E001 already exists for 2026
Request:
{
  "budgets": [
    {
      "companyId": 1,
      "budgetYear": 2026,
      "empCode": "E001", // Duplicate
      "costCenterCode": "CC001"
    }
  ]
}

Expected: HTTP 200 with error in failedResults
```

#### **TC-006: Performance - 50 Rows**
```json
Request: { budgets: [ /* 50 rows */ ] }
Expected: Response time < 5 seconds
```

---

## 9. Performance Considerations

### ‚ö° Optimization Strategies

#### **Batch Size Limits**
```csharp
// Add validation in controller
if (request.Budgets.Count > 100)
{
    return BadRequest(new {
        Success = false,
        Message = "Maximum 100 rows per batch. Please split into smaller batches."
    });
}
```

#### **Database Optimization**
```csharp
// Use AddRange instead of multiple Add calls
await _context.HRB_BUDGET_BJC.AddRangeAsync(bjcBudgets);
await _context.HRB_BUDGET_BIGC.AddRangeAsync(bigcBudgets);
await _context.SaveChangesAsync();
```

#### **Parallel Processing (Advanced)**
```csharp
// For very large batches (>100 rows)
var tasks = budgets.Select(async budget => {
    return await CreateBudgetAsync(budget, budget.CompanyId.Value);
});
var results = await Task.WhenAll(tasks);
```

### üìä Performance Metrics

| Metric | Target | Measurement |
|--------|--------|-------------|
| **API Response Time** | < 2s for 10 rows | Use Postman/Swagger timer |
| **API Response Time** | < 5s for 50 rows | Use Postman/Swagger timer |
| **Database Insert** | < 100ms per row | SQL Server Profiler |
| **Frontend Feedback** | Immediate | Loading overlay shows < 200ms |

---

## 10. Security & Validation

### üîí Security Measures

#### **1. Authentication & Authorization**
```csharp
[Authorize] // Add authentication requirement
[HttpPost("B0SaveBatchEntry")]
public async Task<IActionResult> SaveBatchEntry(...)
{
    // Get current user from auth context
    var currentUser = User.Identity?.Name ?? "System";
    // Pass to service
}
```

#### **2. Input Sanitization**
```csharp
// Sanitize string inputs
budget.EmpCode = budget.EmpCode?.Trim();
budget.CostCenterCode = budget.CostCenterCode?.Trim();
```

#### **3. SQL Injection Protection**
‚úÖ Entity Framework Core provides built-in protection
‚úÖ Always use parameterized queries
‚ùå Never concatenate SQL strings

#### **4. Rate Limiting**
```csharp
// Add rate limiting middleware
[EnableRateLimiting("BatchSavePolicy")]
[HttpPost("B0SaveBatchEntry")]
```

### ‚úÖ Validation Rules

#### **Frontend Validation (Already Implemented)**
- ‚úÖ Required fields validation
- ‚úÖ Format validation (dates, numbers)
- ‚úÖ Business rules (budget logic)
- ‚úÖ 3-level validation gates

#### **Backend Validation (To Add)**
```csharp
// Server-side validation (defense in depth)
private void ValidateBudgetEntry(BudgetResponseDto budget)
{
    var errors = new List<string>();

    // Required fields
    if (string.IsNullOrWhiteSpace(budget.EmpCode))
        errors.Add("Employee Code is required");
    
    if (string.IsNullOrWhiteSpace(budget.CostCenterCode))
        errors.Add("Cost Center Code is required");
    
    if (budget.BudgetYear <= 0)
        errors.Add("Budget Year is required");
    
    if (!budget.CompanyId.HasValue)
        errors.Add("Company ID is required");

    // Business rules
    if (budget.BudgetYear < 2020 || budget.BudgetYear > 2030)
        errors.Add("Budget Year must be between 2020 and 2030");

    if (budget.Payroll < 0)
        errors.Add("Payroll cannot be negative");

    if (errors.Any())
        throw new ValidationException(string.Join("; ", errors));
}
```

---

## üìù Summary & Next Steps

### ‚úÖ Key Decisions Made

1. **Transaction Strategy:** Individual transactions (partial success allowed)
2. **Error Handling:** Detailed error reporting per row
3. **Response Format:** Comprehensive BatchBudgetResponse with success/failed lists
4. **Company Routing:** Service layer handles BJC/BIGC table routing
5. **Validation:** Frontend + Backend validation (defense in depth)

### üéØ Implementation Order

1. ‚úÖ **Phase 1:** Backend DTOs & Service (2 days)
2. ‚úÖ **Phase 2:** Controller Endpoint (1 day)
3. ‚úÖ **Phase 3:** Frontend Integration (1 day)
4. ‚úÖ **Phase 4:** Testing (2 days)
5. ‚úÖ **Phase 5:** Documentation & Deployment (1 day)

**Total Estimated Time:** 7 days

### üìã Checklist Before SA Approval

- [x] DTO structure defined
- [x] Service method logic planned
- [x] Controller endpoint specified
- [x] Data flow diagram complete
- [x] Error handling strategy documented
- [x] Transaction approach selected
- [x] Field mapping strategy clear
- [x] Test cases identified
- [x] Performance targets set
- [x] Security measures outlined

---

## üîç Questions for SA Review

### **Q1: Transaction Strategy**
> ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ batch save ‡πÄ‡∏õ‡πá‡∏ô "all or nothing" (‡∏ñ‡πâ‡∏≤ 1 ‡πÅ‡∏ñ‡∏ß‡∏ú‡∏¥‡∏î ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å) ‡∏´‡∏£‡∏∑‡∏≠ "partial success" (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ó‡∏µ‡πà valid)?

**Recommendation:** Partial success (Individual transactions)

---

### **Q2: Batch Size Limit**
> ‡∏Ñ‡∏ß‡∏£‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ñ‡∏ß‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ï‡πà‡∏≠ 1 batch ‡πÑ‡∏ß‡πâ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?

**Recommendation:** 100 rows per batch (can increase if performance allows)

---

### **Q3: Duplicate Handling**
> ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ duplicate entry (EMP_CODE + BUDGET_YEAR + COST_CENTER_CODE ‡∏ã‡πâ‡∏≥) ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ:
> - A. Reject (return error)
> - B. Update existing record
> - C. Skip duplicate

**Recommendation:** Option A (Reject with clear error message)

---

### **Q4: Authentication**
> ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ authentication ‡∏Å‡πà‡∏≠‡∏ô save ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πà ‡πÉ‡∏ä‡πâ system ‡πÉ‡∏î?

**Current:** No authentication in existing endpoints  
**Recommendation:** Add `[Authorize]` attribute if auth system exists

---

#### **üìñ ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î**

**Authentication ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?**

Authentication (‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô) ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏Ñ‡∏£‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ save ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

---

#### **üîç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô**

‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå `BudgetController.cs` ‡∏û‡∏ö‡∏ß‡πà‡∏≤:

```csharp
// ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ [Authorize] attribute
[HttpPost]
public async Task<IActionResult> CreateBudget([FromBody] CreateBudgetRequest request)
{
    // ‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á login
    var result = await _budgetService.CreateBudgetAsync(...);
    return Ok(result);
}
```

**‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á:**
- ‚ùå ‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÑ‡∏î‡πâ (‡∏ñ‡πâ‡∏≤‡∏£‡∏π‡πâ URL)
- ‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ track ‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå

---

#### **üí° ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Q4**

<details>
<summary><strong>Option A: ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ Authentication (‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Production)</strong></summary>

```csharp
// ‡πÑ‡∏°‡πà‡∏°‡∏µ [Authorize]
[HttpPost("B0SaveBatchEntry")]
public async Task<IActionResult> SaveBatchEntry(
    [FromBody] BatchBudgetRequest request)
{
    // ‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÑ‡∏î‡πâ
    var response = await _budgetService.CreateBatchBudgetsAsync(...);
    return Ok(response);
}
```

**‚úÖ Pros:**
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á setup authentication system
- Development ‡∏á‡πà‡∏≤‡∏¢‡∏Å‡∏ß‡πà‡∏≤
- Frontend ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á token

**‚ùå Cons:**
- ‚ùå ‡πÑ‡∏°‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÑ‡∏î‡πâ)
- ‚ùå ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- ‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ HRBP)

**‚ö†Ô∏è ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö:**
- Development/Testing environment
- Internal network only
- Demo/POC

</details>

<details>
<summary><strong>Option B: ‡πÉ‡∏ä‡πâ Authentication (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Production) ‚≠ê</strong></summary>

```csharp
// ‡πÄ‡∏û‡∏¥‡πà‡∏° [Authorize]
[Authorize] // ‚Üê ‡∏ï‡πâ‡∏≠‡∏á login ‡∏Å‡πà‡∏≠‡∏ô
[HttpPost("B0SaveBatchEntry")]
public async Task<IActionResult> SaveBatchEntry(
    [FromBody] BatchBudgetRequest request)
{
    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• user ‡∏ó‡∏µ‡πà login
    var currentUser = User.Identity?.Name ?? "Unknown";
    var userId = User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
    
    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏£‡πâ‡∏≠‡∏° audit trail
    var response = await _budgetService.CreateBatchBudgetsAsync(
        request.Budgets, 
        currentUser // ‚Üê ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
    );
    
    return Ok(response);
}
```

**‚úÖ Pros:**
- ‚úÖ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (‡∏ï‡πâ‡∏≠‡∏á login ‡∏Å‡πà‡∏≠‡∏ô)
- ‚úÖ ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Audit trail)
- ‚úÖ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏î‡πâ

**‚ùå Cons:**
- ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ authentication system (JWT, Cookie, etc.)
- Frontend ‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ token
- ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏ß‡πà‡∏≤

**‚ö†Ô∏è ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö:**
- **Production environment** ‚úÖ
- Multiple users
- ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ audit trail

</details>

<details>
<summary><strong>Option C: ‡πÉ‡∏ä‡πâ Authentication + Authorization (Advanced) üîê</strong></summary>

```csharp
// ‡πÄ‡∏û‡∏¥‡πà‡∏° role-based authorization
[Authorize(Roles = "HRBP,Admin")] // ‚Üê ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ HRBP/Admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
[HttpPost("B0SaveBatchEntry")]
public async Task<IActionResult> SaveBatchEntry(
    [FromBody] BatchBudgetRequest request)
{
    var currentUser = User.Identity?.Name ?? "Unknown";
    var userRole = User.FindFirst(ClaimTypes.Role)?.Value;
    
    // Log who did what
    _logger.LogInformation(
        "User {User} (Role: {Role}) saved {Count} budgets", 
        currentUser, userRole, request.Budgets.Count
    );
    
    var response = await _budgetService.CreateBatchBudgetsAsync(
        request.Budgets, 
        currentUser
    );
    
    return Ok(response);
}
```

**‚úÖ Pros:**
- ‚úÖ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
- ‚úÖ ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ role)
- ‚úÖ Audit trail ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô

**‚ùå Cons:**
- ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ role management system
- ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

**‚ö†Ô∏è ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö:**
- Enterprise system
- Multi-tenant
- Compliance requirements

</details>

---

#### **üéØ Authentication Systems ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö**

‡∏ñ‡πâ‡∏≤ SA ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Option B/C ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ authentication system ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á:

| System | Description | Setup Complexity |
|--------|-------------|------------------|
| **JWT Token** | JSON Web Token (modern, stateless) | ‚≠ê‚≠ê‚≠ê ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á |
| **Cookie Auth** | Traditional cookie-based (ASP.NET Identity) | ‚≠ê‚≠ê ‡∏á‡πà‡∏≤‡∏¢ |
| **Azure AD** | Microsoft Azure Active Directory | ‚≠ê‚≠ê‚≠ê‚≠ê ‡∏¢‡∏≤‡∏Å |
| **OAuth 2.0** | Third-party (Google, Facebook) | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê ‡∏¢‡∏≤‡∏Å‡∏°‡∏≤‡∏Å |

---

#### **üî• JWT Token vs OAuth 2.0: ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î**

<details>
<summary><strong>üéØ JWT Token (JSON Web Token)</strong> ‚≠ê RECOMMENDED ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Budget System</summary>

**üìñ ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?**

JWT ‡πÄ‡∏õ‡πá‡∏ô token-based authentication ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• user ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô token ‡πÄ‡∏≠‡∏á (self-contained)

**üîÑ ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:**
```
1. User login ‚Üí Server verify ‚Üí Generate JWT Token
2. Client ‡πÄ‡∏Å‡πá‡∏ö token (localStorage)
3. ‡∏ó‡∏∏‡∏Å request ‡∏™‡πà‡∏á token ‡πÉ‡∏ô header
4. Server verify token ‚Üí Allow access
```

**‚úÖ ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- ‚úÖ **Stateless:** Server ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö session (scalable)
- ‚úÖ **Fast:** ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á query database ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
- ‚úÖ **Simple:** ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö internal system
- ‚úÖ **Cross-domain:** ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏Å‡∏±‡∏ö mobile app, SPA
- ‚úÖ **Self-contained:** ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• user ‡πÉ‡∏ô token
- ‚úÖ **No external dependency:** ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏∂‡πà‡∏á third-party

**‚ùå ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:**
- ‚ùå Token size ‡πÉ‡∏´‡∏ç‡πà‡∏Å‡∏ß‡πà‡∏≤ session ID
- ‚ùå ‡∏¢‡∏≤‡∏Å revoke (‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ token ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏)
- ‚ùå ‡∏ñ‡πâ‡∏≤ token ‡∏ñ‡∏π‡∏Å‡∏Ç‡πÇ‡∏°‡∏¢ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏

**üìä ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á JWT Token:**
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.
eyJ1c2VySWQiOiIxMjM0IiwidXNlcm5hbWUiOiJocmJwMDEiLCJyb2xlIjoiSFJCUCJ9.
SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```

**üîß Setup (ASP.NET Core):**
```csharp
// 1. Install Package
// dotnet add package Microsoft.AspNetCore.Authentication.JwtBearer

// 2. Configure in Program.cs
builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
    .AddJwtBearer(options =>
    {
        options.TokenValidationParameters = new TokenValidationParameters
        {
            ValidateIssuer = true,
            ValidateAudience = true,
            ValidateLifetime = true,
            ValidateIssuerSigningKey = true,
            ValidIssuer = "YourIssuer",
            ValidAudience = "YourAudience",
            IssuerSigningKey = new SymmetricSecurityKey(
                Encoding.UTF8.GetBytes("YourSecretKey")
            )
        };
    });

// 3. Login Endpoint
[HttpPost("login")]
public IActionResult Login([FromBody] LoginRequest request)
{
    // Verify username/password
    if (ValidateUser(request.Username, request.Password))
    {
        var token = GenerateJwtToken(request.Username);
        return Ok(new { token });
    }
    return Unauthorized();
}

// 4. Use in Controller
[Authorize]
[HttpPost("B0SaveBatchEntry")]
public async Task<IActionResult> SaveBatchEntry(...)
{
    var currentUser = User.Identity?.Name;
    // ...
}
```

**üí∞ Cost:** FREE (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢)

**‚è±Ô∏è Setup Time:** 1 ‡∏ß‡∏±‡∏ô

**üéØ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö:**
- ‚úÖ **Internal system** (Budget System) ‚Üê **‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥**
- ‚úÖ Company-owned users
- ‚úÖ Simple authentication
- ‚úÖ Mobile app + Web
- ‚úÖ Microservices architecture

</details>

<details>
<summary><strong>üåê OAuth 2.0 (Third-Party Authentication)</strong></summary>

**üìñ ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?**

OAuth 2.0 ‡πÄ‡∏õ‡πá‡∏ô authorization protocol ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ third-party (Google, Facebook, Microsoft) ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ authenticate ‡πÅ‡∏ó‡∏ô

**üîÑ ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:**
```
1. User click "Login with Google"
2. Redirect ‡πÑ‡∏õ Google login page
3. Google verify ‚Üí Return authorization code
4. Exchange code ‚Üí Get access token
5. Use token to access Google API
6. Get user info ‚Üí Create session
```

**‚úÖ ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- ‚úÖ **No password management:** ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö password
- ‚úÖ **Social login:** Login ‡∏î‡πâ‡∏ß‡∏¢ Google/Facebook/Microsoft
- ‚úÖ **Better security:** ‡πÉ‡∏ä‡πâ security ‡∏Ç‡∏≠‡∏á Google/Facebook
- ‚úÖ **User convenience:** ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏≥ password
- ‚úÖ **2FA built-in:** Google ‡∏°‡∏µ 2-factor authentication

**‚ùå ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:**
- ‚ùå **External dependency:** ‡∏û‡∏∂‡πà‡∏á third-party (Google down = ‡πÑ‡∏°‡πà login ‡πÑ‡∏î‡πâ)
- ‚ùå **Complex setup:** ‡∏ï‡πâ‡∏≠‡∏á register app, callback URL, etc.
- ‚ùå **Privacy concern:** Google/Facebook ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤ user ‡πÉ‡∏ä‡πâ app ‡∏≠‡∏∞‡πÑ‡∏£
- ‚ùå **Not suitable for internal:** ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Google account
- ‚ùå **Cost:** ‡∏ö‡∏≤‡∏á provider ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô (Azure AD ‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡∏∑‡πâ‡∏≠ license)
- ‚ùå **Network required:** ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ internet ‡πÄ‡∏™‡∏°‡∏≠

**üîß Setup (ASP.NET Core - Google OAuth):**
```csharp
// 1. Install Package
// dotnet add package Microsoft.AspNetCore.Authentication.Google

// 2. Register at Google Cloud Console
// - Create OAuth 2.0 Client ID
// - Get ClientId and ClientSecret
// - Set Redirect URI: https://yourapp.com/signin-google

// 3. Configure in Program.cs
builder.Services.AddAuthentication(options =>
{
    options.DefaultScheme = CookieAuthenticationDefaults.AuthenticationScheme;
    options.DefaultChallengeScheme = GoogleDefaults.AuthenticationScheme;
})
.AddCookie()
.AddGoogle(options =>
{
    options.ClientId = "YOUR_GOOGLE_CLIENT_ID";
    options.ClientSecret = "YOUR_GOOGLE_CLIENT_SECRET";
    options.CallbackPath = "/signin-google";
});

// 4. Login Flow
[HttpGet("login-google")]
public IActionResult LoginGoogle()
{
    var properties = new AuthenticationProperties
    {
        RedirectUri = "/api/Budget/B0SaveBatchEntry"
    };
    return Challenge(properties, GoogleDefaults.AuthenticationScheme);
}
```

**üí∞ Cost:**
- Google OAuth: FREE (‡∏°‡∏µ quota limit)
- Azure AD: **‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡∏∑‡πâ‡∏≠ license** ($6-$30/user/month)
- Facebook: FREE

**‚è±Ô∏è Setup Time:** 2-3 ‡∏ß‡∏±‡∏ô (‡∏ï‡πâ‡∏≠‡∏á register, configure, test)

**üéØ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö:**
- ‚ùå **‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö Internal system**
- ‚úÖ Public-facing apps (E-commerce, Social media)
- ‚úÖ B2C applications
- ‚úÖ Startup/SaaS products
- ‚úÖ External users

</details>

---

#### **üìä JWT vs OAuth 2.0: Comparison Table**

| Feature | JWT Token ‚≠ê | OAuth 2.0 |
|---------|-------------|-----------|
| **‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°** | ‚úÖ **Internal system** | ‚ùå External users |
| **Setup Complexity** | ‚≠ê‚≠ê‚≠ê ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê ‡∏¢‡∏≤‡∏Å‡∏°‡∏≤‡∏Å |
| **Setup Time** | 1 ‡∏ß‡∏±‡∏ô | 2-3 ‡∏ß‡∏±‡∏ô |
| **Cost** | FREE | FREE-Paid |
| **External Dependency** | ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ | ‚úÖ ‡∏°‡∏µ (Google/FB) |
| **Password Management** | ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö password | ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö |
| **Scalability** | ‚úÖ Excellent (stateless) | ‚ö†Ô∏è Good |
| **Security** | ‚úÖ Good (‡∏ñ‡πâ‡∏≤ implement ‡∏ñ‡∏π‡∏Å) | ‚úÖ Excellent |
| **User Experience** | ‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏≥ password | ‡∏á‡πà‡∏≤‡∏¢‡∏Å‡∏ß‡πà‡∏≤ (social login) |
| **Network Required** | ‡πÅ‡∏Ñ‡πà‡∏ï‡∏≠‡∏ô login | ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á |
| **Offline Support** | ‚úÖ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ (token cache) | ‚ùå ‡∏ï‡πâ‡∏≠‡∏á online |
| **Revocation** | ‚ùå ‡∏¢‡∏≤‡∏Å | ‚úÖ ‡∏á‡πà‡∏≤‡∏¢ |
| **Token Size** | ‡πÉ‡∏´‡∏ç‡πà‡∏Å‡∏ß‡πà‡∏≤ (~200 bytes) | ‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤ (~50 bytes) |
| **Use Case** | ‚úÖ **Budget System** | ‚ùå Public apps |

---

#### **üéØ ‡∏™‡∏£‡∏∏‡∏õ: ‡∏≠‡∏±‡∏ô‡πÑ‡∏´‡∏ô‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏±‡∏ô?**

**‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Budget System ‡∏ô‡∏µ‡πâ:**

### ‚úÖ **JWT Token ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏ß‡πà‡∏≤** ‡πÄ‡∏û‡∏£‡∏≤‡∏∞:

1. **Internal System:**
   - Budget system ‡πÄ‡∏õ‡πá‡∏ô internal company tool
   - User ‡∏Ñ‡∏∑‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô HRBP (‡∏°‡∏µ company account ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß)
   - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ social login

2. **Simpler:**
   - Setup ‡∏á‡πà‡∏≤‡∏¢‡∏Å‡∏ß‡πà‡∏≤ (1 ‡∏ß‡∏±‡∏ô vs 2-3 ‡∏ß‡∏±‡∏ô)
   - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏∂‡πà‡∏á third-party
   - Maintenance ‡∏á‡πà‡∏≤‡∏¢‡∏Å‡∏ß‡πà‡∏≤

3. **Cost:**
   - FREE ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢
   - OAuth 2.0 (Azure AD) ‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡∏∑‡πâ‡∏≠ license

4. **Performance:**
   - Stateless (‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤)
   - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á call external API

5. **Offline Support:**
   - Token cache ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ network ‡∏ä‡πâ‡∏≤
   - OAuth 2.0 ‡∏ï‡πâ‡∏≠‡∏á online ‡πÄ‡∏™‡∏°‡∏≠

---

### ‚ùå **OAuth 2.0 ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö Budget System** ‡πÄ‡∏û‡∏£‡∏≤‡∏∞:

1. **Internal System ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Social Login:**
   - User ‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà public
   - ‡∏°‡∏µ company account ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
   - ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á "Login with Google"

2. **External Dependency:**
   - ‡∏ñ‡πâ‡∏≤ Google/Azure down ‚Üí ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
   - ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£ downtime

3. **Complex & Costly:**
   - Setup ‡∏¢‡∏≤‡∏Å (register app, callback, etc.)
   - Azure AD ‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡∏∑‡πâ‡∏≠ license ($6-$30/user/month)
   - Budget system ‡∏°‡∏µ user ‡πÄ‡∏¢‡∏≠‡∏∞ = ‡πÅ‡∏û‡∏á

4. **Privacy:**
   - Google/Facebook ‡∏à‡∏∞‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤ user ‡πÉ‡∏ä‡πâ Budget system
   - ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• sensitive

---

#### **üí° Recommendation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SA**

**‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ implement authentication (Q4 Option B/C):**

### üéØ **‡πÄ‡∏•‡∏∑‡∏≠‡∏Å JWT Token** ‚≠ê

**‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:**
1. ‚úÖ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö internal system
2. ‚úÖ Setup ‡∏á‡πà‡∏≤‡∏¢ (1 ‡∏ß‡∏±‡∏ô)
3. ‚úÖ FREE ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢
4. ‚úÖ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏∂‡πà‡∏á third-party
5. ‚úÖ Performance ‡∏î‡∏µ (stateless)
6. ‚úÖ Offline support

**Implementation:**
```csharp
// Simple JWT implementation
[Authorize] // ‚Üê ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÅ‡∏Ñ‡πà‡∏ô‡∏µ‡πâ
[HttpPost("B0SaveBatchEntry")]
public async Task<IActionResult> SaveBatchEntry(...)
{
    var currentUser = User.Identity?.Name; // ‡πÑ‡∏î‡πâ username
    // ...
}
```

---

### ‚ö†Ô∏è **‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ OAuth 2.0 ‡πÄ‡∏°‡∏∑‡πà‡∏≠:**

- ‚ùå Budget system **‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà internal** (‡πÄ‡∏õ‡πá‡∏ô public-facing)
- ‚ùå ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ **external users** login
- ‚ùå ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ **social login** (Google/Facebook)
- ‚ùå ‡∏°‡∏µ **B2C** use case
- ‚ùå ‡∏°‡∏µ **Azure AD** ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß (‡πÅ‡∏•‡∏∞‡∏ã‡∏∑‡πâ‡∏≠ license ‡πÅ‡∏•‡πâ‡∏ß)

**‡πÅ‡∏ï‡πà Budget System ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ**

---

#### **üìã ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Q4**

**‡∏ñ‡πâ‡∏≤ SA ‡∏ï‡∏≠‡∏ö‡∏ß‡πà‡∏≤:**

1. **"‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ authentication"** ‚Üí ‡πÉ‡∏ä‡πâ **JWT Token** ‚úÖ
2. **"‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ authentication"** ‚Üí Option A (‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ production)
3. **"‡∏°‡∏µ Azure AD ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß"** ‚Üí ‡πÉ‡∏ä‡πâ **Azure AD** (OAuth 2.0)
4. **"‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ social login"** ‚Üí ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö Budget System

**‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:** **JWT Token** ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Budget System ‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö! üéØ

---

#### **üìã Frontend Impact (‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Option B/C)**

**1. ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° Token ‡πÉ‡∏ô API Call:**

```javascript
// Before (Option A)
const response = await fetch('/api/Budget/B0SaveBatchEntry', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({ budgets: batchData })
});

// After (Option B/C)
const token = localStorage.getItem('authToken'); // ‡∏î‡∏∂‡∏á token ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ
const response = await fetch('/api/Budget/B0SaveBatchEntry', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}` // ‚Üê ‡πÄ‡∏û‡∏¥‡πà‡∏° token
  },
  body: JSON.stringify({ budgets: batchData })
});
```

**2. ‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Token Expiration:**

```javascript
// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö token ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
if (response.status === 401) { // Unauthorized
  // Token ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ‚Üí redirect ‡πÑ‡∏õ login
  window.location.href = '/login';
}
```

**3. ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Login Flow:**

```
User ‚Üí Login Page ‚Üí Enter Username/Password ‚Üí Get Token ‚Üí Store Token ‚Üí Use Token in API
```

---

#### **üîë Implementation Steps (‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Option B)**

**Backend (5 steps):**

1. **Install Package:**
   ```bash
   dotnet add package Microsoft.AspNetCore.Authentication.JwtBearer
   ```

2. **Configure in Program.cs:**
   ```csharp
   builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
       .AddJwtBearer(options => { /* config */ });
   ```

3. **Add Authorize Attribute:**
   ```csharp
   [Authorize]
   [HttpPost("B0SaveBatchEntry")]
   ```

4. **Get Current User:**
   ```csharp
   var currentUser = User.Identity?.Name;
   ```

5. **Store in Audit Field:**
   ```csharp
   budget.UpdatedBy = currentUser;
   ```

**Frontend (3 steps):**

1. **Store Token after Login:**
   ```javascript
   localStorage.setItem('authToken', token);
   ```

2. **Add Token to Request:**
   ```javascript
   headers: { 'Authorization': `Bearer ${token}` }
   ```

3. **Handle 401 Response:**
   ```javascript
   if (response.status === 401) { window.location.href = '/login'; }
   ```

---

#### **üìä Comparison Table**

| Feature | Option A | Option B | Option C |
|---------|----------|----------|----------|
| **‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢** | ‚ùå ‡∏ï‡πà‡∏≥ | ‚úÖ ‡∏™‡∏π‡∏á | ‚úÖ ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î |
| **Audit Trail** | ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ | ‚úÖ ‡∏°‡∏µ | ‚úÖ ‡∏°‡∏µ + Log |
| **‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°** | ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ | ‚ö†Ô∏è ‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô | ‚úÖ ‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î |
| **Setup Time** | 0 ‡∏ß‡∏±‡∏ô | +1 ‡∏ß‡∏±‡∏ô | +2 ‡∏ß‡∏±‡∏ô |
| **Frontend Impact** | ‡πÑ‡∏°‡πà‡∏°‡∏µ | ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ | ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ |
| **‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö** | Dev/Test | Production | Enterprise |

---

#### **üéØ ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà SA ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≠‡∏ö**

1. **‡∏°‡∏µ authentication system ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?**
   - ‚úÖ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ ‚Üí ‡πÉ‡∏ä‡πâ Option B (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)
   - ‚ùå ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‚Üí ‡∏ï‡πâ‡∏≠‡∏á setup ‡πÉ‡∏´‡∏°‡πà ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Option A ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß

2. **‡∏ñ‡πâ‡∏≤‡∏°‡∏µ authentication ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏∞‡πÑ‡∏£?**
   - JWT Token
   - Cookie-based (ASP.NET Identity)
   - Azure AD
   - ‡∏≠‡∏∑‡πà‡∏ô‡πÜ

3. **‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏ö‡∏ö role-based ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?**
   - ‚úÖ ‡πÉ‡∏ä‡πà ‚Üí Option C (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ HRBP/Admin)
   - ‚ùå ‡πÑ‡∏°‡πà ‚Üí Option B (‡πÅ‡∏Ñ‡πà login ‡∏Å‡πá‡∏û‡∏≠)

4. **Environment ‡πÑ‡∏´‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞ deploy?**
   - Development ‚Üí Option A ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
   - Production ‚Üí **‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Option B/C** ‚≠ê

---

#### **üí° Recommendation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SA**

**‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Authentication System ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß:**
- ‚úÖ **‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Option B** - ‡πÄ‡∏û‡∏¥‡πà‡∏° `[Authorize]` attribute
- ‚úÖ ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ implementation +1 ‡∏ß‡∏±‡∏ô
- ‚úÖ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞ audit trail ‡∏Ñ‡∏£‡∏ö

**‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Authentication System:**
- ‚ö†Ô∏è **‡πÉ‡∏ä‡πâ Option A ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Development
- ‚ö†Ô∏è ‡πÅ‡∏ï‡πà **‡∏ï‡πâ‡∏≠‡∏á** implement Option B ‡∏Å‡πà‡∏≠‡∏ô Production
- ‚ö†Ô∏è ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ setup authentication system ‡πÄ‡∏•‡∏¢ (+2-3 ‡∏ß‡∏±‡∏ô)

**‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Production environment **‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ Option A** ‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î!

---

### **Q5: Success Message Strategy**
> ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ:
> - A. Modal ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏£‡∏∏‡∏õ + auto-close
> - B. Modal ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î + ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î
> - C. Toast notification + auto-close

**Current Implementation:** Option A (Modal + auto-clear form)

---

### **Q6: Duplicate Check Strategy** ‚≠ê NEW
> ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥ (duplicate) ‡∏Å‡∏±‡∏ö database ‡∏Å‡πà‡∏≠‡∏ô save ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?

#### **Option A: ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô (Rely on Database Constraint)**

```csharp
// ‡πÑ‡∏°‡πà query check, save ‡πÄ‡∏•‡∏¢
await CreateBjcBudgetAsync(budget);

// ‡∏ñ‡πâ‡∏≤ duplicate ‚Üí catch DbUpdateException (SQL Error 2627)
catch (DbUpdateException ex) when (ex.InnerException is SqlException sqlEx && 
    sqlEx.Number == 2627)
{
    throw new ArgumentException("Duplicate entry found");
}
```

**‚úÖ Pros:**
- ‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ (1 query per row: INSERT only)
- Database guarantee uniqueness (‡πÑ‡∏°‡πà‡∏°‡∏µ race condition)
- ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î database resources

**‚ùå Cons:**
- Error message generic (‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢ user-friendly)
- ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏à‡∏∞ duplicate

**Performance:** < 100ms per row

---

#### **Option B: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô save (Pre-Check + Custom Error Message)** ‚≠ê RECOMMENDED

```csharp
// Step 1: Check duplicate first
var exists = await _context.HRB_BUDGET_BJC
    .AnyAsync(b => 
        b.EmpCode == budget.EmpCode && 
        b.BudgetYear == budget.BudgetYear &&
        b.CostCenterCode == budget.CostCenterCode
    );

if (exists)
{
    throw new DuplicateException(
        $"‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏´‡∏±‡∏™ {budget.EmpCode} ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏õ‡∏µ {budget.BudgetYear} " +
        $"‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Cost Center {budget.CostCenterCode} ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß"
    );
}

// Step 2: Then save
await CreateBjcBudgetAsync(budget);
```

**‚úÖ Pros:**
- Error message ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‚úÖ
- ‡∏£‡∏π‡πâ‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô save ‚úÖ
- UX ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ (‡πÅ‡∏à‡πâ‡∏á duplicate ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á) ‚úÖ

**‚ùå Cons:**
- ‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤ (2 queries per row: SELECT + INSERT)
- Potential race condition (‡πÅ‡∏ï‡πà‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ï‡πà‡∏≥‡∏°‡∏≤‡∏Å)

**Performance:** ~150-200ms per row (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô ~50-100ms)

---

#### **üéØ UX Considerations (‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Option B)**

**Frontend ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö:**

1. **Loading State ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô**
   ```javascript
   // ‡πÅ‡∏™‡∏î‡∏á loading message ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
   this.showLoadingOverlay('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...');
   ```

2. **Error Message ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î**
   ```javascript
   // Error message ‡∏à‡∏≤‡∏Å backend ‡∏à‡∏∞‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô
   {
     "errorMessage": "‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏´‡∏±‡∏™ E001 ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏õ‡∏µ 2026 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Cost Center CC001 ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß"
   }
   
   // ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô
   {
     "errorMessage": "Duplicate entry found"
   }
   ```

3. **Performance Notice (Optional)**
   ```javascript
   // ‡∏ñ‡πâ‡∏≤ batch ‡πÉ‡∏´‡∏ç‡πà (>20 rows) ‡∏≠‡∏≤‡∏à‡πÅ‡∏™‡∏î‡∏á warning
   if (batchData.length > 20) {
     console.warn('Large batch detected. Duplicate check may take longer.');
   }
   ```

4. **Error Display ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á**
   ```javascript
   showBatchErrorDetails: function (failedResults) {
     // ‡πÅ‡∏™‡∏î‡∏á error ‡πÅ‡∏ö‡∏ö grouped by type
     const duplicateErrors = failedResults.filter(e => 
       e.errorMessage.includes('‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß')
     );
     const otherErrors = failedResults.filter(e => 
       !e.errorMessage.includes('‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß')
     );
     
     // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏¢‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
     html += `<h6>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥ (${duplicateErrors.length} ‡πÅ‡∏ñ‡∏ß)</h6>`;
     html += `<h6>‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏≠‡∏∑‡πà‡∏ô‡πÜ (${otherErrors.length} ‡πÅ‡∏ñ‡∏ß)</h6>`;
   }
   ```

---

#### **üìä Performance Impact (Option B vs Option A)**

| Batch Size | Option A Time | Option B Time | Difference |
|------------|---------------|---------------|------------|
| 10 rows | ~1.0s | ~1.5s | +50% |
| 50 rows | ~5.0s | ~7.5s | +50% |
| 100 rows | ~10.0s | ~15.0s | +50% |

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Option B ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö Performance Target ‡πÉ‡∏´‡∏°‡πà:
- 10 rows: < **3s** (‡πÄ‡∏î‡∏¥‡∏° 2s)
- 50 rows: < **8s** (‡πÄ‡∏î‡∏¥‡∏° 5s)

---

#### **üí° Hybrid Approach (Option C - Advanced)**

```csharp
// Batch check duplicates ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏Ñ‡∏£‡∏≤‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
var empCodes = budgets.Select(b => b.EmpCode).ToList();
var existingBudgets = await _context.HRB_BUDGET_BJC
    .Where(b => empCodes.Contains(b.EmpCode) && b.BudgetYear == budgets[0].BudgetYear)
    .Select(b => new { b.EmpCode, b.CostCenterCode })
    .ToListAsync();

// Check duplicates in memory
foreach (var budget in budgets)
{
    var isDuplicate = existingBudgets.Any(e => 
        e.EmpCode == budget.EmpCode && 
        e.CostCenterCode == budget.CostCenterCode
    );
    if (isDuplicate) { /* error */ }
}
```

**‚úÖ Pros:**
- ‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ Option B (1 SELECT query ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á batch + individual INSERTs)
- Error message ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Option B

**‚ùå Cons:**
- ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏ß‡πà‡∏≤
- ‡πÉ‡∏ä‡πâ memory ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô (‡πÄ‡∏Å‡πá‡∏ö existing budgets in memory)

**Performance:** ~100-120ms per row (‡∏Å‡∏•‡∏≤‡∏á‡πÜ ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á A ‡πÅ‡∏•‡∏∞ B)

---

#### **üéØ Recommendation**

**‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ Option B** ‡πÄ‡∏û‡∏£‡∏≤‡∏∞:
1. ‚úÖ UX ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (error message ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô)
2. ‚úÖ ‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£ implement ‡πÅ‡∏•‡∏∞ maintain
3. ‚úÖ Performance impact ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ (batch ‡∏°‡∏±‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 20-30 rows)
4. ‚úÖ Frontend ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÄ‡∏¢‡∏≠‡∏∞ (‡πÅ‡∏Ñ‡πà loading message)

**‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Option C:** ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ batch size ‡πÉ‡∏´‡∏ç‡πà‡∏ö‡πà‡∏≠‡∏¢‡πÜ (>50 rows) ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ performance ‡∏î‡∏µ

---

## üìå Status: ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å SA

**‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô:** Ten (AI Developer)  
**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:** 19 ‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° 2025  
**‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥:** _________________________  
**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥:** _________________________  

---

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô DRAFT ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å SA ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ Implementation

---

## üìå ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (Executive Summary)

### üéØ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏´‡∏•‡∏±‡∏Å
‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà `setTimeout` simulation ‡πÉ‡∏ô `budget.plan.events.js` ‡∏î‡πâ‡∏ß‡∏¢ API call ‡∏à‡∏£‡∏¥‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Batch Budget Entry

### üìä ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏á‡∏≤‡∏ô
- **Frontend:** ‡∏™‡∏£‡πâ‡∏≤‡∏á `saveBatchBudgetData()` function ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API
- **Backend:** ‡∏™‡∏£‡πâ‡∏≤‡∏á endpoint `POST /api/Budget/B0SaveBatchEntry`
- **DTO:** ‡∏™‡∏£‡πâ‡∏≤‡∏á `BatchBudgetRequest.cs` ‡πÅ‡∏•‡∏∞ `BatchBudgetResponse.cs`
- **Service:** ‡πÄ‡∏û‡∏¥‡πà‡∏° `CreateBatchBudgetsAsync()` ‡πÉ‡∏ô BudgetService

### üè¢ Company Routing
- **CompanyId = 1** ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á `HRB_BUDGET_BJC` table
- **CompanyId = 2** ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á `HRB_BUDGET_BIGC` table

### üóÑÔ∏è Database Fields Pattern
- **LE (Last Estimate):** ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ suffix `*_LE` (‡πÄ‡∏ä‡πà‡∏ô `PAYROLL_LE`)
- **Current Year:** ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏õ‡∏Å‡∏ï‡∏¥‡πÑ‡∏°‡πà‡∏°‡∏µ suffix (‡πÄ‡∏ä‡πà‡∏ô `PAYROLL`)
- **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ü‡∏¥‡∏•‡∏î‡πå `*_NX` (Next Year) ‡∏ó‡∏±‡πâ‡∏á BJC ‡πÅ‡∏•‡∏∞ BIGC

### üîÑ Field Mapping
```
"batch-company" ‚Üí COMPANY_ID (001‚Üí1, 002‚Üí2)
"batch-year" ‚Üí BUDGET_YEAR
"batchLe-payroll" ‚Üí PAYROLL_LE
"batchBg-payroll" ‚Üí PAYROLL
```

### üîí Transaction Strategy (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)
**Individual Transactions** - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡∏•‡∏∞‡πÅ‡∏ñ‡∏ß ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô success/failure ‡πÅ‡∏¢‡∏Å‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô

### üìù Error Handling
- **Partial Success:** ‡πÅ‡∏à‡πâ‡∏á success/failed count ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ñ‡∏ß
- **Per-Row Tracking:** ‡∏£‡∏∞‡∏ö‡∏∏ `rowIndex`, `empCode`, `errorMessage` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß

### ‚ö° Performance Target
- **10 rows:** < 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
- **50 rows:** < 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
- **Batch Limit:** ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ 100 rows ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î

### üß™ Test Cases
- TC-001: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (BJC)
- TC-002: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (BIGC)
- TC-003: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏°‡∏µ Duplicate Entry)
- TC-004: Validation Error (Missing Required Field)
- TC-005: Duplicate Entry (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
- TC-006: Performance Test (50 rows)

### üìÖ Implementation Timeline

**‚ö†Ô∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** Timeline ‡∏≠‡∏≤‡∏à‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏° Q6 Answer

| Phase | ‡∏á‡∏≤‡∏ô | Option A | Option B ‚≠ê |
|-------|-----|----------|------------|
| **Phase 1** | Backend DTOs & Service | 2 ‡∏ß‡∏±‡∏ô | **2.5 ‡∏ß‡∏±‡∏ô** (+0.5 duplicate check) |
| **Phase 2** | Controller Endpoint | 1 ‡∏ß‡∏±‡∏ô | 1 ‡∏ß‡∏±‡∏ô |
| **Phase 3** | Frontend Integration | 1 ‡∏ß‡∏±‡∏ô | **1.5 ‡∏ß‡∏±‡∏ô** (+0.5 UX enhancements) |
| **Phase 4** | Testing | 2 ‡∏ß‡∏±‡∏ô | **2.5 ‡∏ß‡∏±‡∏ô** (+0.5 duplicate tests) |
| **Phase 5** | Documentation & Deployment | 1 ‡∏ß‡∏±‡∏ô | 1 ‡∏ß‡∏±‡∏ô |
| **‡∏£‡∏ß‡∏°** | | **7 ‡∏ß‡∏±‡∏ô** | **8.5 ‡∏ß‡∏±‡∏ô** |

**Option B ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô:**
- Backend: Duplicate check logic + Custom exception
- Frontend: Enhanced loading message + Error grouping + Performance warning
- Testing: Duplicate check tests + Thai message validation

### ‚ùì Questions ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å SA
1. **Transaction Strategy:** All-or-nothing ‡∏´‡∏£‡∏∑‡∏≠ Partial success?
2. **Batch Size Limit:** ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏µ‡πà‡πÅ‡∏ñ‡∏ß‡∏ï‡πà‡∏≠ batch?
3. **Duplicate Handling:** Reject, Update ‡∏´‡∏£‡∏∑‡∏≠ Skip?
4. **Authentication:** ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ authentication ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?
5. **Success Message:** Modal ‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô (auto-close ‡∏´‡∏£‡∏∑‡∏≠ manual)?
6. **Duplicate Check Strategy:** ‚≠ê ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô save (Option B) ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏∂‡πà‡∏á DB constraint (Option A)?

### ‚úÖ Status
- [x] ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå DTOs ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô (8 files)
- [x] ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Database Models (BJC/BIGC)
- [x] ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö API Endpoint ‡∏û‡∏£‡πâ‡∏≠‡∏° Request/Response
- [x] ‡∏™‡∏£‡πâ‡∏≤‡∏á Data Flow Diagram
- [x] ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô Error Handling Strategy
- [x] ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Transaction Management
- [x] ‡∏™‡∏£‡πâ‡∏≤‡∏á Test Cases (6 scenarios)
- [x] ‡∏à‡∏±‡∏î‡∏ó‡∏≥ Implementation Plan (7 days)
- [ ] **‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å SA**

### üì¶ Deliverables ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
1. ‚úÖ `BatchBudgetRequest.cs` - Request DTO
2. ‚úÖ `BatchBudgetResponse.cs` - Response DTO
3. ‚úÖ `BudgetSaveResult.cs` - Success result model
4. ‚úÖ `BudgetSaveError.cs` - Error result model
5. ‚úÖ `CreateBatchBudgetsAsync()` - Service method logic
6. ‚úÖ `SaveBatchEntry()` - Controller endpoint
7. ‚úÖ `saveBatchBudgetData()` - Frontend API call function
8. ‚úÖ Error handling & validation logic
9. ‚úÖ Test cases & performance metrics
10. ‚úÖ Complete implementation guide

---

**üìå End of Document**
